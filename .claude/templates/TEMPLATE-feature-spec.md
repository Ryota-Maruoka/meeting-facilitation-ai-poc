---
title: "<Feature>: Spec"
status: "wip"
owner: "@owner"
related: []
last_update: "YYYY-MM-DD"
confidentiality: "internal"
---

# 1. 概要

この機能の**目的・背景・価値**を簡潔に説明します。  
（例：「顧客情報を管理し、案件・請求など他機能の基礎マスタとして利用する」）

---

# 2. ユースケース / 受入基準

| No | ユースケース | 概要 | 受入基準 |
|----|---------------|------|-----------|
| UC-1 | 顧客を登録する | フォーム入力で新規顧客を登録 | 正常登録後、一覧に即時反映される |
| UC-2 | 顧客を検索する | 名前・コード・タグで検索可能 | 絞込結果が正確に表示される |
| UC-3 | 顧客を削除する | 管理権限のみ削除可能 | 削除後は論理削除状態で保持される |

> 💡 *受入基準（Acceptance Criteria）* はテスト観点の基礎になるため、  
> 明確で検証可能な条件で記述すること。

---

# 3. 主な画面 / 遷移

| No | 画面名 | パス | 概要 |
|----|--------|------|------|
| 1 | 一覧画面 | `/customers` | 顧客の検索・一覧表示 |
| 2 | 詳細画面 | `/customers/{id}` | 顧客詳細・紐付データ参照 |
| 3 | 編集画面 | `/customers/{id}/edit` | 顧客情報の更新 |

- 画面遷移図・ワイヤーフレームは `/images/` に配置して相対リンクで参照。  
  例：`![](../images/customers-flow.drawio.png)`

---

# 4. 入出力データ構造（要約）

| 区分 | 項目名 | 型 | 必須 | 備考 |
|------|--------|----|------|------|
| Input | name | string | ○ | 顧客名 |
| Input | email | string | - | 重複不可 |
| Output | id | uuid | ○ | 登録時に自動発番 |
| Output | created_at | datetime | ○ | 監査項目 |

> 詳細なスキーマ定義は `table-schema/tables.md` を参照。

---

# 5. 非機能要件（この機能に特有のもの）

| 区分 | 要件 | 補足 |
|------|------|------|
| 性能 | 顧客検索は1000件以内を100ms以下で返す | RLS / index最適化 |
| セキュリティ | tenant_id によるRLS適用 | 全SQL必須 |
| 可用性 | API障害時はキャッシュレスポンス提供 | Redis参照 |
| 監査 | 変更履歴を versioning テーブルに保存 | insert/update時に記録 |

---

# 6. エラーハンドリング・例外処理

| ケース | メッセージ | 対応 |
|---------|------------|------|
| バリデーションエラー | `Invalid customer data` | 400を返却 |
| 権限不足 | `Forbidden` | 403を返却 |
| DB一意制約違反 | `Duplicate email` | 409を返却 |

---

# 7. 関連API・仕様リンク

- `api/contracts.md` — エンドポイント定義  
- `table-schema/tables.md` — テーブル構造  
- `design.md` — 処理・トランザクション設計  
- `adr/adr-xxxx.md` — 関連する設計決定（例：RLS適用方針）

---

# 8. 未決事項・リスク

- 顧客タグ機能のスコープをどこまで含めるか未決。  
- 検索結果のページング方式（offset vs keyset）要検討。

---

# 9. メモ / コメント（任意）

- 検証環境では `tenant_id='demo'` のみで試験する。  
- 他機能（案件管理・請求管理）での参照影響あり。

---
